#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"name":"csharp","languageName":"csharp"},{"name":"fsharp","languageName":"F#","aliases":["f#","fs"]},{"name":"html","languageName":"HTML"},{"name":"http","languageName":"HTTP"},{"name":"javascript","languageName":"JavaScript","aliases":["js"]},{"name":"mermaid","languageName":"Mermaid"},{"name":"pwsh","languageName":"PowerShell","aliases":["powershell"]},{"name":"value"}]}}

#!markdown

# arXiv document extraction

Playground for pulling arXiv document data.

#!csharp

#r "nuget:System.Net.Http, *-*"

#!csharp

using System.Net.Http;
using System.Xml.Linq;

#!csharp

public record ArxivPaper(string Id, string Title)
{
    public required string Summary { get; init; }

    public required Uri PdfUri { get; init; }

    public DateTime Published { get; init; }

    public IReadOnlyCollection<string> Authors { get; init; } = [];
}

#!csharp

private const string API_BASE_URL = "http://export.arxiv.org/api/query";

var httpClient = new HttpClient
{
    BaseAddress = new Uri(API_BASE_URL)
};

async Task<IReadOnlyList<ArxivPaper>> SearchArxivPapersAsync(string query, int maxResults = 10)
{
    var requestUri = $"?search_query=all:{Uri.EscapeDataString(query)}&start=0&max_results={maxResults}";

    var response = await httpClient.GetAsync(requestUri);
    response.EnsureSuccessStatusCode();

    var content = await response.Content.ReadAsStringAsync();

    var xmlDoc = System.Xml.Linq.XDocument.Parse(content);
    XNamespace ns = "http://www.w3.org/2005/Atom";

    var entries = xmlDoc.Root.Elements(ns + "entry");

    var papers = entries.Select(entry =>
    {
        var id = entry.Element(ns + "id")?.Value.Split('/').Last() ?? string.Empty;
        var title = entry.Element(ns + "title")?.Value.Trim() ?? string.Empty;
        var summary = entry.Element(ns + "summary")?.Value.Trim() ?? string.Empty;
        var publishedStr = entry.Element(ns + "published")?.Value ?? string.Empty;
        DateTime.TryParse(publishedStr, out var published);
        var authors = entry.Elements(ns + "author").Select(a => a.Element(ns + "name")?.Value.Trim() ?? string.Empty).ToList();
        var pdfLink = entry.Elements(ns + "link")
                           .FirstOrDefault(l => l.Attribute("title")?.Value == "pdf")
                           ?.Attribute("href")?.Value ?? string.Empty;

        return new ArxivPaper(id, title)
        {
            Summary = summary,
            Published = published,
            Authors = authors,
            PdfUri = new Uri(pdfLink)
        };
    }).ToList();

    return papers;
}

#!csharp

await SearchArxivPapersAsync("quantum computing", 5)
